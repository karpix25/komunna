# üéì Kommuna - –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –≤ Telegram

–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –∫—É—Ä—Å–æ–≤ –∏ —Ä–∞–∑–≤–∏—Ç–∏—è —Å–æ–æ–±—â–µ—Å—Ç–≤ –≤ Telegram.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
kommuna/
‚îú‚îÄ‚îÄ frontend/          # Next.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ backend/           # FastAPI API —Å–µ—Ä–≤–µ—Ä
‚îú‚îÄ‚îÄ bot/              # Telegram –±–æ—Ç (aiogram 3)
‚îú‚îÄ‚îÄ database/         # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è PostgreSQL
‚îú‚îÄ‚îÄ docker-compose.yml # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Docker
‚îú‚îÄ‚îÄ .env.example      # –ü—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ Makefile          # –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–æ–º
‚îî‚îÄ‚îÄ README.md         # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
```bash
git clone <repository-url>
cd kommuna
```

### 2. –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
```bash
# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ .env —Ñ–∞–π–ª–∞
make setup

# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª —Å –≤–∞—à–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
nano .env
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `.env` —Ñ–∞–π–ª:

```env
# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
DB_PASSWORD=your_strong_password_here

# –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
JWT_SECRET_KEY=your_super_secret_jwt_key_minimum_32_characters_long
ENCRYPTION_KEY=your_encryption_key_exactly_32_chars

# Telegram –±–æ—Ç
TELEGRAM_BOT_TOKEN=your_telegram_bot_token_here
TELEGRAM_WEBHOOK_DOMAIN=https://your-ngrok-id.ngrok-free.app
```

### 4. –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞
```bash
# –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
make up

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
make status
```

### 5. –î–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–∏—Å–∞–º
- üåê Frontend: http://localhost:3000
- üîß Backend API: http://localhost:8000
- üìö API Documentation: http://localhost:8000/docs
- üóÑÔ∏è PostgreSQL: localhost:5432

## üõ†Ô∏è –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
make help

# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
make up                 # –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ
make down              # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ
make restart           # –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ

# –õ–æ–≥–∏
make logs              # –í—Å–µ –ª–æ–≥–∏
make logs-backend      # –õ–æ–≥–∏ backend
make logs-bot          # –õ–æ–≥–∏ –±–æ—Ç–∞
make logs-db           # –õ–æ–≥–∏ –ë–î

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
make db-shell          # –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ PostgreSQL
make db-reset          # –°–±—Ä–æ—Å–∏—Ç—å –ë–î (–û–°–¢–û–†–û–ñ–ù–û!)

# –û—á–∏—Å—Ç–∫–∞
make clean             # –û—á–∏—Å—Ç–∏—Ç—å Docker —Ä–µ—Å—É—Ä—Å—ã
make clean-all         # –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (–û–°–¢–û–†–û–ñ–ù–û!)
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ backend

```
backend/src/
‚îú‚îÄ‚îÄ main.py           # –û—Å–Ω–æ–≤–Ω–æ–µ FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ config.py         # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–∑ env –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ database.py       # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ë–î –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è–º–∏
‚îî‚îÄ‚îÄ models/           # SQLAlchemy –º–æ–¥–µ–ª–∏
    ‚îú‚îÄ‚îÄ base.py       # –ë–∞–∑–æ–≤—ã–µ –∫–ª–∞—Å—Å—ã –º–æ–¥–µ–ª–µ–π
    ‚îú‚îÄ‚îÄ user.py       # –ú–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    ‚îú‚îÄ‚îÄ community.py  # –ú–æ–¥–µ–ª—å —Å–æ–æ–±—â–µ—Å—Ç–≤–∞
    ‚îî‚îÄ‚îÄ ...           # –î—Ä—É–≥–∏–µ –º–æ–¥–µ–ª–∏
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–æ—Ç–∞

```
bot/src/
‚îî‚îÄ‚îÄ main.py           # –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –±–æ—Ç–∞ (aiogram 3)
```

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
- `users` - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏–∑ Telegram
- `telegram_bots` - –ë–æ—Ç—ã —Å–æ–æ–±—â–µ—Å—Ç–≤
- `telegram_groups` - –ì—Ä—É–ø–ø—ã/–∫–∞–Ω–∞–ª—ã
- `communities` - –°–æ–æ–±—â–µ—Å—Ç–≤–∞ —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ –∫–ª—é—á–∞–º–∏
- `community_admins` - –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã —Å–æ–æ–±—â–µ—Å—Ç–≤
- `gamification_rules` - –ü—Ä–∞–≤–∏–ª–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –æ—á–∫–æ–≤
- `level_rules` - –°–∏—Å—Ç–µ–º–∞ —É—Ä–æ–≤–Ω–µ–π

### –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Ç–∞–±–ª–∏—Ü—ã
–î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞ —Å–æ–∑–¥–∞—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:
- `community_users_{key}` - –£—á–∞—Å—Ç–Ω–∏–∫–∏ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞
- `courses_{key}` - –ö—É—Ä—Å—ã —Å–æ–æ–±—â–µ—Å—Ç–≤–∞
- `lessons_{key}` - –£—Ä–æ–∫–∏ –∫—É—Ä—Å–æ–≤
- `lesson_progress_{key}` - –ü—Ä–æ–≥—Ä–µ—Å—Å –∏–∑—É—á–µ–Ω–∏—è
- –ò –¥—Ä—É–≥–∏–µ...

## ü§ñ Telegram –±–æ—Ç

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–æ—Ç–∞

1. –°–æ–∑–¥–∞–π—Ç–µ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ @BotFather –≤ Telegram
2. –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –∏ –¥–æ–±–∞–≤—å—Ç–µ –≤ `.env`:
   ```env
   TELEGRAM_BOT_TOKEN=your_bot_token_here
   ```
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ ngrok –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:
   ```bash
   # –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ ngrok –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ
   ngrok http 8000

   # –°–∫–æ–ø–∏—Ä—É–π—Ç–µ URL –≤ .env
   TELEGRAM_WEBHOOK_DOMAIN=https://your-id.ngrok-free.app
   ```

### –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞
- `/start` - –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ

## üåê –î–µ–ø–ª–æ–π

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å ngrok

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ ngrok: https://ngrok.com/
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç—É–Ω–Ω–µ–ª—å:
   ```bash
   ngrok http 8000
   ```
3. –û–±–Ω–æ–≤–∏—Ç–µ `TELEGRAM_WEBHOOK_DOMAIN` –≤ `.env`
4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç:
   ```bash
   make restart
   ```

### –ü—Ä–æ–¥–∞–∫—à–Ω –¥–µ–ø–ª–æ–π

–î–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:
- –†–µ–∞–ª—å–Ω—ã–π –¥–æ–º–µ–Ω —Å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º
- –í–Ω–µ—à–Ω—é—é PostgreSQL –ë–î
- Docker Swarm –∏–ª–∏ Kubernetes
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|------------|----------|---------|
| `DB_PASSWORD` | –ü–∞—Ä–æ–ª—å PostgreSQL | `strong_password_123` |
| `JWT_SECRET_KEY` | –°–µ–∫—Ä–µ—Ç –¥–ª—è JWT —Ç–æ–∫–µ–Ω–æ–≤ | `secret_key_32_chars_minimum` |
| `ENCRYPTION_KEY` | –ö–ª—é—á —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è (32 —Å–∏–º–≤–æ–ª–∞) | `exactly_32_character_string_here` |
| `TELEGRAM_BOT_TOKEN` | –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –æ—Ç @BotFather | `123456:ABC-DEF...` |
| `TELEGRAM_WEBHOOK_DOMAIN` | –î–æ–º–µ–Ω –¥–ª—è webhook | `https://example.com` |

### –ü–æ—Ä—Ç—ã

| –°–µ—Ä–≤–∏—Å | –ü–æ—Ä—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|------|----------|
| Frontend | 3000 | Next.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ |
| Backend | 8000 | FastAPI API |
| PostgreSQL | 5432 | –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö |
| Bot | - | –†–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ webhook |

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Health checks
- Backend: http://localhost:8000/health
- Bot: –õ–æ–≥–∏ —á–µ—Ä–µ–∑ `make logs-bot`

### –õ–æ–≥–∏
```bash
# –í—Å–µ –ª–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
make logs

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å–µ—Ä–≤–∏—Å
make logs-backend
make logs-bot
make logs-db
```

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–±–ª–µ–º—ã —Å –∑–∞–ø—É—Å–∫–æ–º

1. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è**
   ```bash
   # –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å
   make status

   # –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –ë–î
   make logs-db
   ```

2. **–ë–æ—Ç –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è**
   ```bash
   # –ü—Ä–æ–≤–µ—Ä—å—Ç–µ webhook –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
   make logs-bot

   # –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ TELEGRAM_WEBHOOK_DOMAIN –¥–æ—Å—Ç—É–ø–µ–Ω
   curl https://your-domain.com/webhook
   ```

3. **Frontend –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è**
   ```bash
   # –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–±–æ—Ä–∫—É
   make logs-frontend

   # –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
   make build
   ```

## ü§ù –£—á–∞—Å—Ç–∏–µ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

1. –§–æ—Ä–∫–Ω–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
2. –°–æ–∑–¥–∞–π—Ç–µ feature –≤–µ—Ç–∫—É
3. –í–Ω–µ—Å–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
4. –î–æ–±–∞–≤—å—Ç–µ —Ç–µ—Å—Ç—ã
5. –°–æ–∑–¥–∞–π—Ç–µ Pull Request

## üìù TODO

- [ ] –î–æ–±–∞–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å API endpoints –¥–ª—è –∫—É—Ä—Å–æ–≤
- [ ] –°–æ–∑–¥–∞—Ç—å –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å Telegram Payments
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É –∏ –º–µ—Ç—Ä–∏–∫–∏

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License - —Å–º. —Ñ–∞–π–ª LICENSE

## üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `make logs`
2. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ `.env` —Ñ–∞–π–ª–∞
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã: `make clean && make up`
4. –°–æ–∑–¥–∞–π—Ç–µ Issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏

---

**Kommuna** - –°–æ–∑–¥–∞–≤–∞–π—Ç–µ. –û–±—É—á–∞–π—Ç–µ. –†–∞–∑–≤–∏–≤–∞–π—Ç–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞. üöÄ